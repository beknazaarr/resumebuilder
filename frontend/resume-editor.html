<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä —Ä–µ–∑—é–º–µ - Resume Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
        }

        /* Header */
        header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        nav {
            max-width: 1800px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2563eb;
            text-decoration: none;
        }

        .nav-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
            font-size: 0.9rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: white;
            color: #2563eb;
            border: 2px solid #2563eb;
        }

        .btn-secondary:hover {
            background: #eff6ff;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        /* Editor Layout */
        .editor-container {
            display: grid;
            grid-template-columns: 400px 1fr;
            max-width: 1800px;
            margin: 0 auto;
            height: calc(100vh - 80px);
        }

        /* Sidebar */
        .sidebar {
            background: white;
            overflow-y: auto;
            border-right: 1px solid #e2e8f0;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }

        .sidebar-header h2 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
        }

        .template-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            background: #f8fafc;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .template-selector:hover {
            background: #f1f5f9;
        }

        .template-selector select {
            flex: 1;
            padding: 0.5rem;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .sections-nav {
            padding: 1rem 0;
        }

        .section-btn {
            width: 100%;
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95rem;
            color: #334155;
            font-weight: 500;
        }

        .section-btn:hover {
            background: #f8fafc;
        }

        .section-btn.active {
            background: #eff6ff;
            color: #2563eb;
            border-left: 3px solid #2563eb;
        }

        .section-content {
            padding: 1.5rem;
            display: none;
        }

        .section-content.active {
            display: block;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #334155;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #2563eb;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
        }

        /* Items List */
        .items-list {
            margin-top: 1rem;
        }

        .item-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }

        .item-card:hover {
            border-color: #2563eb;
        }

        .item-card h4 {
            margin-bottom: 0.5rem;
            color: #1e293b;
        }

        .item-card p {
            font-size: 0.85rem;
            color: #64748b;
            margin: 0.25rem 0;
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .btn-small {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }

        .btn-icon {
            padding: 0.5rem;
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .btn-icon:hover {
            background: #f1f5f9;
            color: #2563eb;
        }

        .add-item-btn {
            width: 100%;
            padding: 0.75rem;
            background: #eff6ff;
            border: 2px dashed #2563eb;
            color: #2563eb;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .add-item-btn:hover {
            background: #dbeafe;
        }

        /* Preview Panel */
        .preview-panel {
            background: #e2e8f0;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .preview-controls {
            width: 100%;
            max-width: 900px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .zoom-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .zoom-btn {
            padding: 0.5rem 1rem;
            background: white;
            border: 2px solid #cbd5e1;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .zoom-btn:hover {
            border-color: #2563eb;
        }

        .preview-content {
        padding: 0; /* ‚Üê –ë—ã–ª–æ 40px */
        min-height: auto; /* ‚Üê –ë—ã–ª–æ 1100px */
        background: white;
    }

    .preview-wrapper {
        width: 100%;
        max-width: 900px;
        background: white;
        box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        transition: transform 0.3s;
        overflow: hidden; /* ‚Üê –î–æ–±–∞–≤—å —ç—Ç–æ */
    }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h3 {
            font-size: 1.3rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
        }

        .loading {
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #2563eb;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #64748b;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        @media (max-width: 1200px) {
            .editor-container {
                grid-template-columns: 350px 1fr;
            }
        }

        @media (max-width: 768px) {
            .editor-container {
                grid-template-columns: 1fr;
            }

            .preview-panel {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <nav>
            <a href="/dashboard.html" class="logo">‚Üê Resume Builder</a>
            <div class="nav-actions">
                <button class="btn btn-secondary" onclick="saveResume()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-success" onclick="exportPDF()">üì• –°–∫–∞—á–∞—Ç—å PDF</button>
            </div>
        </nav>
    </header>

    <!-- Editor Container -->
    <div class="editor-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2 id="resumeTitle">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—é–º–µ</h2>
                <div class="template-selector">
                    <label>–®–∞–±–ª–æ–Ω:</label>
                    <select id="templateSelect" onchange="changeTemplate()">
                        <option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>
                    </select>
                </div>
            </div>

            <div class="sections-nav">
                <button class="section-btn active" onclick="switchSection('personal')">
                    üë§ –õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                    <span>‚Üí</span>
                </button>
                <button class="section-btn" onclick="switchSection('experience')">
                    üíº –û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã
                    <span id="experienceCount">0</span>
                </button>
                <button class="section-btn" onclick="switchSection('education')">
                    üéì –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
                    <span id="educationCount">0</span>
                </button>
                <button class="section-btn" onclick="switchSection('skills')">
                    ‚ö° –ù–∞–≤—ã–∫–∏
                    <span id="skillsCount">0</span>
                </button>
                <button class="section-btn" onclick="switchSection('achievements')">
                    üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
                    <span id="achievementsCount">0</span>
                </button>
                <button class="section-btn" onclick="switchSection('languages')">
                    üåç –Ø–∑—ã–∫–∏
                    <span id="languagesCount">0</span>
                </button>
            </div>

            <!-- Personal Info Section -->
            <!-- Personal Info Section -->
<!-- Personal Info Section -->
<div id="personalSection" class="section-content active">
    <h3>–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
    <div id="alertPersonal" class="alert"></div>
    
    <form id="personalInfoForm">
        <!-- –§–ò–û -->
        <div class="form-group">
            <label>–§–ò–û *</label>
            <input type="text" id="fullName" required placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
        </div>

        <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
        <div class="form-group">
            <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input type="tel" id="phone" placeholder="+996 XXX XXX XXX">
        </div>

        <!-- Email -->
        <div class="form-group">
            <label>Email *</label>
            <input type="email" id="email" required placeholder="example@mail.com">
        </div>

        <!-- –ê–¥—Ä–µ—Å -->
        <div class="form-group">
            <label>–ê–¥—Ä–µ—Å</label>
            <input type="text" id="address" placeholder="–ë–∏—à–∫–µ–∫, –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω">
        </div>

        <!-- LinkedIn -->
        <div class="form-group">
            <label>LinkedIn</label>
            <input type="url" id="linkedin" placeholder="https://linkedin.com/in/username">
        </div>

        <!-- Website -->
        <div class="form-group">
            <label>–í–µ–±-—Å–∞–π—Ç</label>
            <input type="url" id="website" placeholder="https://mywebsite.com">
        </div>

        <!-- –û —Å–µ–±–µ -->
        <div class="form-group">
            <label>–û —Å–µ–±–µ</label>
            <textarea id="summary" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ, —Å–≤–æ–µ–º –æ–ø—ã—Ç–µ –∏ —Ü–µ–ª—è—Ö..."></textarea>
        </div>

        <button type="submit" class="btn btn-primary" style="width: 100%;">
            üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–∏—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        </button>
    </form>

    <!-- –°–µ–∫—Ü–∏—è —Ñ–æ—Ç–æ -->
    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid #e2e8f0;">
        <h3>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è</h3>
        <div id="alertPhoto" class="alert"></div>
        
        <div id="photoPreview" style="margin-bottom: 1rem;">
            <div id="currentPhoto" style="display: none;">
                <img id="photoImage" style="max-width: 200px; border-radius: 8px; margin-bottom: 1rem;" />
                <div>
                    <button type="button" class="btn btn-secondary btn-small" onclick="removePhoto()">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ
                    </button>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</label>
            <input type="file" id="photoInput" accept="image/*" onchange="uploadPhoto()">
            <p style="font-size: 0.85rem; color: #64748b; margin-top: 0.5rem;">
                –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB. –§–æ—Ä–º–∞—Ç—ã: JPG, PNG, WEBP
            </p>
        </div>
    </div>
</div>
            
            <!-- –í personalSection, –ø–æ—Å–ª–µ —Ñ–æ—Ä–º—ã personalInfoForm -->

            <!-- Experience Section -->
            <div id="experienceSection" class="section-content">
                <h3>–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã</h3>
                <div id="alertExperience" class="alert"></div>
                <div id="experienceList" class="items-list"></div>
                <button class="add-item-btn" onclick="openExperienceModal()">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã
                </button>
            </div>

            <!-- Education Section -->
            <div id="educationSection" class="section-content">
                <h3>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</h3>
                <div id="alertEducation" class="alert"></div>
                <div id="educationList" class="items-list"></div>
                <button class="add-item-btn" onclick="openEducationModal()">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
                </button>
            </div>

            <!-- Skills Section -->
            <div id="skillsSection" class="section-content">
                <h3>–ù–∞–≤—ã–∫–∏</h3>
                <div id="alertSkills" class="alert"></div>
                <div id="skillsList" class="items-list"></div>
                <button class="add-item-btn" onclick="openSkillModal()">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≤—ã–∫
                </button>
            </div>

            <!-- Achievements Section -->
            <div id="achievementsSection" class="section-content">
                <h3>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
                <div id="alertAchievements" class="alert"></div>
                <div id="achievementsList" class="items-list"></div>
                <button class="add-item-btn" onclick="openAchievementModal()">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
                </button>
            </div>

            <!-- Languages Section -->
            <div id="languagesSection" class="section-content">
                <h3>–Ø–∑—ã–∫–∏</h3>
                <div id="alertLanguages" class="alert"></div>
                <div id="languagesList" class="items-list"></div>
                <button class="add-item-btn" onclick="openLanguageModal()">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å —è–∑—ã–∫
                </button>
            </div>
        </div>

        <!-- Preview Panel -->
        <div class="preview-panel">
            <div class="preview-controls">
                <div class="zoom-controls">
                    <button class="zoom-btn" onclick="zoomOut()">‚àí</button>
                    <span id="zoomLevel">100%</span>
                    <button class="zoom-btn" onclick="zoomIn()">+</button>
                </div>
                <button class="btn btn-secondary" onclick="refreshPreview()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
            <div class="preview-wrapper" id="previewWrapper">
                <div class="preview-content" id="previewContent">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Work Experience Modal -->
    <div class="modal" id="experienceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="experienceModalTitle">–î–æ–±–∞–≤–∏—Ç—å –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã</h3>
                <button class="close-btn" onclick="closeExperienceModal()">&times;</button>
            </div>
            <form id="experienceForm">
                <div class="form-group">
                    <label>–ö–æ–º–ø–∞–Ω–∏—è *</label>
                    <input type="text" id="expCompany" required>
                </div>
                <div class="form-group">
                    <label>–î–æ–ª–∂–Ω–æ—Å—Ç—å *</label>
                    <input type="text" id="expPosition" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ *</label>
                        <input type="date" id="expStartDate" required>
                    </div>
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                        <input type="date" id="expEndDate">
                    </div>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="expIsCurrent" onchange="toggleEndDate('exp')">
                    <label>–Ø —Ä–∞–±–æ—Ç–∞—é –∑–¥–µ—Å—å —Å–µ–π—á–∞—Å</label>
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π</label>
                    <textarea id="expDescription" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </form>
        </div>
    </div>

    <!-- Education Modal -->
    <div class="modal" id="educationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="educationModalTitle">–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</h3>
                <button class="close-btn" onclick="closeEducationModal()">&times;</button>
            </div>
            <form id="educationForm">
                <div class="form-group">
                    <label>–£—á–µ–±–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ *</label>
                    <input type="text" id="eduInstitution" required>
                </div>
                <div class="form-group">
                    <label>–°—Ç–µ–ø–µ–Ω—å/–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è *</label>
                    <input type="text" id="eduDegree" required placeholder="–ë–∞–∫–∞–ª–∞–≤—Ä, –ú–∞–≥–∏—Å—Ç—Ä...">
                </div>
                <div class="form-group">
                    <label>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å *</label>
                    <input type="text" id="eduField" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ *</label>
                        <input type="date" id="eduStartDate" required>
                    </div>
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                        <input type="date" id="eduEndDate">
                    </div>
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="eduDescription" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </form>
        </div>
    </div>

    <!-- Skill Modal -->
    <div class="modal" id="skillModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="skillModalTitle">–î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≤—ã–∫</h3>
                <button class="close-btn" onclick="closeSkillModal()">&times;</button>
            </div>
            <form id="skillForm">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–≤—ã–∫–∞ *</label>
                    <input type="text" id="skillName" required placeholder="JavaScript, Photoshop...">
                </div>
                <div class="form-group">
                    <label>–£—Ä–æ–≤–µ–Ω—å –≤–ª–∞–¥–µ–Ω–∏—è *</label>
                    <select id="skillLevel" required>
                        <option value="beginner">–ù–∞—á–∞–ª—å–Ω—ã–π</option>
                        <option value="intermediate">–°—Ä–µ–¥–Ω–∏–π</option>
                        <option value="advanced">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</option>
                        <option value="expert">–≠–∫—Å–ø–µ—Ä—Ç</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select id="skillCategory">
                        <option value="technical">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ</option>
                        <option value="soft">–ì–∏–±–∫–∏–µ –Ω–∞–≤—ã–∫–∏</option>
                        <option value="language">–Ø–∑—ã–∫–∏</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </form>
        </div>
    </div>

    <!-- Achievement Modal -->
    <div class="modal" id="achievementModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="achievementModalTitle">–î–æ–±–∞–≤–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ</h3>
                <button class="close-btn" onclick="closeAchievementModal()">&times;</button>
            </div>
            <form id="achievementForm">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è *</label>
                    <input type="text" id="achievementTitle" required>
                </div>
                <div class="form-group">
                    <label>–î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è</label>
                    <input type="date" id="achievementDate">
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="achievementDescription"></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </form>
        </div>
    </div>

    <!-- Language Modal -->
    <div class="modal" id="languageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="languageModalTitle">–î–æ–±–∞–≤–∏—Ç—å —è–∑—ã–∫</h3>
                <button class="close-btn" onclick="closeLanguageModal()">&times;</button>
            </div>
            <form id="languageForm">
                <div class="form-group">
                    <label>–Ø–∑—ã–∫ *</label>
                    <input type="text" id="languageName" required placeholder="–†—É—Å—Å–∫–∏–π, –ê–Ω–≥–ª–∏–π—Å–∫–∏–π...">
                </div>
                <div class="form-group">
                    <label>–£—Ä–æ–≤–µ–Ω—å –≤–ª–∞–¥–µ–Ω–∏—è *</label>
                    <select id="languageLevel" required>
                        <option value="A1">A1 - –ù–∞—á–∞–ª—å–Ω—ã–π</option>
                        <option value="A2">A2 - –≠–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω—ã–π</option>
                        <option value="B1">B1 - –°—Ä–µ–¥–Ω–∏–π</option>
                        <option value="B2">B2 - –í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ</option>
                        <option value="C1">C1 - –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</option>
                        <option value="C2">C2 - –í–ª–∞–¥–µ–Ω–∏–µ –≤ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–µ</option>
                        <option value="native">–†–æ–¥–Ω–æ–π</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </form>
        </div>
    </div>

    <script src="/static/js/api.js"></script>
    <script src="/static/js/auth.js"></script>
    <script>
        requireAuth();

        let resumeId = null;
        let resumeData = null;
        let currentEditId = null;
        let currentSection = 'personal';
        let currentTemplate = null;
        let zoomScale = 1;

        // –ü–æ–ª—É—á–∏—Ç—å ID —Ä–µ–∑—é–º–µ –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        resumeId = urlParams.get('id');

        if (!resumeId) {
            alert('ID —Ä–µ–∑—é–º–µ –Ω–µ —É–∫–∞–∑–∞–Ω');
            window.location.href = '/dashboard.html';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function init() {
            await loadTemplates();
            await loadResume();
            await loadCurrentPhoto();
            await loadAllData();
            setupEventListeners();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤
        async function loadTemplates() {
            try {
                const data = await API.templates.list();
                const templates = data.results || data;
                
                const select = document.getElementById('templateSelect');
                select.innerHTML = '';
                
                templates.forEach(template => {
                    const option = document.createElement('option');
                    option.value = template.id;
                    option.textContent = template.name;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading templates:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—é–º–µ
        async function loadResume() {
        try {
        resumeData = await API.resumes.get(resumeId);
        document.getElementById('resumeTitle').textContent = resumeData.title;
        
        if (resumeData.template_id) {
            document.getElementById('templateSelect').value = resumeData.template_id;
            await loadTemplate(resumeData.template_id); // ‚Üê –î–û–ë–ê–í–¨ –≠–¢–£ –°–¢–†–û–ö–£
        }
         } catch (error) {
        console.error('Error loading resume:', error);
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—é–º–µ');
        window.location.href = '/dashboard.html';
         }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —à–∞–±–ª–æ–Ω–∞
        async function loadTemplate(templateId) {
        try {
            currentTemplate = await API.templates.get(templateId);
            console.log('Template loaded:', currentTemplate);
        } catch (error) {
        console.error('Error loading template:', error);
        currentTemplate = null;
        }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        async function loadAllData() {
            await Promise.all([
                loadPersonalInfo(),
                loadExperience(),
                loadEducation(),
                loadSkills(),
                loadAchievements(),
                loadLanguages()
            ]);
            await refreshPreview();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        async function loadPersonalInfo() {
            try {
                const data = await API.personalInfo.get(resumeId);
                if (data) {
                    document.getElementById('fullName').value = data.full_name || '';
                    document.getElementById('phone').value = data.phone || '';
                    document.getElementById('email').value = data.email || '';
                    document.getElementById('address').value = data.address || '';
                    document.getElementById('linkedin').value = data.linkedin || '';
                    document.getElementById('website').value = data.website || '';
                    document.getElementById('summary').value = data.summary || '';
                }
            } catch (error) {
                console.log('Personal info not yet added');
            }
        }
        // –ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø—ã—Ç–∞ —Ä–∞–±–æ—Ç—ã
        // –ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø—ã—Ç–∞ —Ä–∞–±–æ—Ç—ã
async function loadExperience() {
    try {
        const data = await API.workExperience.list(resumeId);
        const list = document.getElementById('experienceList');
        list.innerHTML = '';
        
        if (data && data.length > 0) {
            data.forEach(item => {
                const card = createExperienceCard(item);
                list.appendChild(card);
            });
        } else {
            list.innerHTML = '<p class="empty-state">–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω</p>';
        }
        
        document.getElementById('experienceCount').textContent = data ? data.length : 0;
    } catch (error) {
        console.error('Error loading experience:', error);
        document.getElementById('experienceList').innerHTML = '<p class="empty-state">–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω</p>';
        document.getElementById('experienceCount').textContent = '0';
    }
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –æ–ø—ã—Ç–∞ —Ä–∞–±–æ—Ç—ã
function createExperienceCard(item) {
    const card = document.createElement('div');
    card.className = 'item-card';
    
    const endDate = item.is_current ? '–Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è' : (item.end_date || '-');
    
    card.innerHTML = `
        <h4>${item.position}</h4>
        <p><strong>${item.company}</strong></p>
        <p>${formatDate(item.start_date)} - ${item.is_current ? '–Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è' : formatDate(item.end_date)}</p>
        ${item.description ? `<p>${item.description.substring(0, 100)}${item.description.length > 100 ? '...' : ''}</p>` : ''}
        <div class="item-actions">
            <button class="btn btn-small btn-secondary" onclick="editExperience(${item.id})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn btn-small btn-secondary" onclick="deleteExperience(${item.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
        </div>
    `;
    
    return card;
}  
        // –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
        async function loadEducation() {
            try {
                const data = await API.education.list(resumeId);
                const list = document.getElementById('educationList');
                list.innerHTML = '';
                data.forEach(item => {
                    const card = createEducationCard(item);
                    list.appendChild(card);
                });
                document.getElementById('educationCount').textContent = data.length;
            } catch (error) {
                console.error('Error loading education:', error);
            }
        }
        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–≤—ã–∫–æ–≤
        async function loadSkills() {
            try {
                const data = await API.skills.list(resumeId);
                const list = document.getElementById('skillsList');
                list.innerHTML = '';
                data.forEach(item => {
                    const card = createSkillCard(item);
                    list.appendChild(card);
                });
                document.getElementById('skillsCount').textContent = data.length;
            } catch (error) {
                console.error('Error loading skills:', error);
            }
        }
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
async function loadAchievements() {
    try {
        const data = await API.achievements.list(resumeId);
        const list = document.getElementById('achievementsList');
        list.innerHTML = '';
        
        if (data && data.length > 0) {
            data.forEach(item => {
                const card = createAchievementCard(item);
                list.appendChild(card);
            });
        } else {
            list.innerHTML = '<p class="empty-state">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>';
        }
        
        document.getElementById('achievementsCount').textContent = data ? data.length : 0;
    } catch (error) {
        console.error('Error loading achievements:', error);
        document.getElementById('achievementsList').innerHTML = '<p class="empty-state">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>';
        document.getElementById('achievementsCount').textContent = '0';
    }
}

function createAchievementCard(item) {
    const card = document.createElement('div');
    card.className = 'item-card';
    
    card.innerHTML = `
        <h4>${item.title}</h4>
        ${item.date ? `<p>üìÖ ${formatDate(item.date)}</p>` : ''}
        ${item.description ? `<p>${item.description.substring(0, 100)}${item.description.length > 100 ? '...' : ''}</p>` : ''}
        <div class="item-actions">
            <button class="btn btn-small btn-secondary" onclick="editAchievement(${item.id})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn btn-small btn-secondary" onclick="deleteAchievement(${item.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
        </div>
    `;
    
    return card;
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —è–∑—ã–∫–æ–≤
async function loadLanguages() {
    try {
        const data = await API.languages.list(resumeId);
        const list = document.getElementById('languagesList');
        list.innerHTML = '';
        
        if (data && data.length > 0) {
            data.forEach(item => {
                const card = createLanguageCard(item);
                list.appendChild(card);
            });
        } else {
            list.innerHTML = '<p class="empty-state">–Ø–∑—ã–∫–∏ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>';
        }
        
        document.getElementById('languagesCount').textContent = data ? data.length : 0;
    } catch (error) {
        console.error('Error loading languages:', error);
        document.getElementById('languagesList').innerHTML = '<p class="empty-state">–Ø–∑—ã–∫–∏ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>';
        document.getElementById('languagesCount').textContent = '0';
    }
}

function createLanguageCard(item) {
    const card = document.createElement('div');
    card.className = 'item-card';
    
    card.innerHTML = `
        <h4>${item.language}</h4>
        <p><strong>–£—Ä–æ–≤–µ–Ω—å:</strong> ${item.proficiency_display || item.proficiency_level}</p>
        <div class="item-actions">
            <button class="btn btn-small btn-secondary" onclick="editLanguage(${item.id})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn btn-small btn-secondary" onclick="deleteLanguage(${item.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
        </div>
    `;
    
    return card;
}

function formatDate(dateString) {
    if (!dateString) return '-';
    const date = new Date(dateString);
    const options = { year: 'numeric', month: 'long' };
    return date.toLocaleDateString('ru-RU', options);
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
async function refreshPreview() {
    const previewContent = document.getElementById('previewContent');
    previewContent.innerHTML = `
        <div class="loading">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞...</p>
        </div>
    `;
    
    try {
        const data = await API.resumes.get(resumeId);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω –ª–∏ —à–∞–±–ª–æ–Ω
        if (!currentTemplate && data.template_id) {
            await loadTemplate(data.template_id);
        }
        
        let html;
        
        if (currentTemplate && currentTemplate.html_structure) {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º HTML –∏–∑ —à–∞–±–ª–æ–Ω–∞
            html = generatePreviewFromTemplate(data, currentTemplate);
        } else {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            html = generatePreviewHTML(data);
        }
        
        previewContent.innerHTML = html;
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º CSS —à–∞–±–ª–æ–Ω–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
        if (currentTemplate && currentTemplate.css_styles) {
            applyTemplateStyles(currentTemplate.css_styles);
        }
        
    } catch (error) {
        console.error('Error refreshing preview:', error);
        previewContent.innerHTML = `
            <div style="padding: 2rem; text-align: center; color: #ef4444;">
                <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>
            </div>
        `;
    }
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –∏–∑ —à–∞–±–ª–æ–Ω–∞ —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π –¥–∞–Ω–Ω—ã—Ö
// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –∏–∑ —à–∞–±–ª–æ–Ω–∞ —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π –¥–∞–Ω–Ω—ã—Ö
function generatePreviewFromTemplate(data, template) {
    const personalInfo = data.personal_info || {};
    const education = data.education || [];
    const workExperience = data.work_experience || [];
    const skills = data.skills || [];
    const achievements = data.achievements || [];
    const languages = data.languages || [];
    
    let html = template.html_structure;
    
    // –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–æ—Ç–æ
    if (data.photo) {
        html = html.replace(/\{\{photo\}\}/g, data.photo);
        // –£–¥–∞–ª—è–µ–º —É—Å–ª–æ–≤–Ω—ã–µ –±–ª–æ–∫–∏ –µ—Å–ª–∏ –µ—Å—Ç—å
        html = html.replace(/\{\{#if photo\}\}/g, '');
        html = html.replace(/\{\{else\}\}[\s\S]*?\{\{\/if\}\}/g, '');
        html = html.replace(/\{\{\/if\}\}/g, '');
    } else {
        // –£–¥–∞–ª—è–µ–º –±–ª–æ–∫ —Å —Ñ–æ—Ç–æ, –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç–æ–π div
        html = html.replace(/\{\{#if photo\}\}[\s\S]*?\{\{else\}\}/g, '');
        html = html.replace(/\{\{\/if\}\}/g, '');
        html = html.replace(/\{\{photo\}\}/g, ''); // –£–¥–∞–ª—è–µ–º –ø—É—Å—Ç—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
    }
    
    // ========== –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –í–°–ï–• –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö ==========
    html = html.replace(/\{\{full_name\}\}/g, personalInfo.full_name || '–í–∞—à–µ –ò–º—è');
    html = html.replace(/\{\{email\}\}/g, personalInfo.email || 'email@example.com');
    html = html.replace(/\{\{phone\}\}/g, personalInfo.phone || '+X XXX XXX XXXX');
    html = html.replace(/\{\{address\}\}/g, personalInfo.address || '–ì–æ—Ä–æ–¥, –°—Ç—Ä–∞–Ω–∞');
    html = html.replace(/\{\{linkedin\}\}/g, personalInfo.linkedin || '');
    html = html.replace(/\{\{website\}\}/g, personalInfo.website || '');
    html = html.replace(/\{\{summary\}\}/g, personalInfo.summary || '–ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ–±–µ');
    
    // –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–ø—ã—Ç–∞ —Ä–∞–±–æ—Ç—ã
    const workHtml = workExperience.map(exp => `
        <div class="experience-item">
            <div class="experience-header">
                <div class="experience-title">${exp.position}</div>
                <div class="experience-date">${formatDate(exp.start_date)} - ${exp.is_current ? 'Present' : formatDate(exp.end_date)}</div>
            </div>
            <div class="experience-company">${exp.company}</div>
            ${exp.description ? `<div class="experience-description">${exp.description}</div>` : ''}
        </div>
    `).join('');
    html = html.replace(/\{\{work_experience\}\}/g, workHtml);
    
    // –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
    const eduHtml = education.map(edu => `
        <div class="education-item">
            <div class="education-header">
                <div class="education-title">${edu.degree} - ${edu.field_of_study}</div>
                <div class="education-date">${formatDate(edu.start_date)} - ${edu.end_date ? formatDate(edu.end_date) : 'Present'}</div>
            </div>
            <div class="education-school">${edu.institution}</div>
            ${edu.description ? `<div class="education-description">${edu.description}</div>` : ''}
        </div>
    `).join('');
    html = html.replace(/\{\{education\}\}/g, eduHtml);
    
    // –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞–≤—ã–∫–æ–≤
    const skillsHtml = skills.map(skill => `
        <li>${skill.name} (${skill.level_display || skill.level})</li>
    `).join('');
    html = html.replace(/\{\{skills\}\}/g, skillsHtml);
    
    // –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π (rewards)
    const achievementsHtml = achievements.map(ach => `
        <div class="reward-item">
            ${ach.date ? `<div class="date">${formatDate(ach.date)}</div>` : ''}
            <div class="title">${ach.title}</div>
        </div>
    `).join('');
    html = html.replace(/\{\{achievements\}\}/g, achievementsHtml);
    html = html.replace(/\{\{rewards\}\}/g, achievementsHtml); // –ù–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è {{rewards}}
    
    // –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ —è–∑—ã–∫–æ–≤
    const languagesHtml = languages.map(lang => `
        <div>${lang.language} - ${lang.proficiency_display || lang.proficiency_level}</div>
    `).join('');
    html = html.replace(/\{\{languages\}\}/g, languagesHtml);
    
    return html;
}
// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
function generatePreviewHTML(data) {
    const personalInfo = data.personal_info || {};
    const education = data.education || [];
    const workExperience = data.work_experience || [];
    const skills = data.skills || [];
    const achievements = data.achievements || [];
    const languages = data.languages || [];
    
    return `
        <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333;">
            <!-- Header -->
            <div style="text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px solid #2563eb;">

    ${data.photo ? `
        <div style="margin-bottom: 20px;">
            <img src="${data.photo}" alt="Photo" style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 4px solid #2563eb;">
        </div>
    ` : ''}

    <h1 style="margin: 0 0 10px 0; color: #1e293b; font-size: 2.5rem;">
        ${personalInfo.full_name || '–í–∞—à–µ –ò–º—è'}
    </h1>

    <div style="color: #64748b; font-size: 0.95rem;">
        ${personalInfo.email ? `üìß ${personalInfo.email}` : ''}
        ${personalInfo.phone ? ` | üì± ${personalInfo.phone}` : ''}
        ${personalInfo.address ? ` | üìç ${personalInfo.address}` : ''}
    </div>

    ${personalInfo.linkedin || personalInfo.website ? `
        <div style="color: #2563eb; font-size: 0.9rem; margin-top: 5px;">
            ${personalInfo.linkedin ? `<a href="${personalInfo.linkedin}" style="color: #2563eb; text-decoration: none;">LinkedIn</a>` : ''}
            ${personalInfo.linkedin && personalInfo.website ? ' | ' : ''}
            ${personalInfo.website ? `<a href="${personalInfo.website}" style="color: #2563eb; text-decoration: none;">Website</a>` : ''}
        </div>
    ` : ''}
</div>


            <!-- –û —Å–µ–±–µ -->
            ${personalInfo.summary ? `
                <div style="margin-bottom: 30px;">
                    <h2 style="color: #2563eb; font-size: 1.5rem; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 2px solid #e2e8f0;">
                        üíº –û —Å–µ–±–µ
                    </h2>
                    <p style="margin: 10px 0; color: #475569; text-align: justify;">
                        ${personalInfo.summary}
                    </p>
                </div>
            ` : ''}

            <!-- –û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã -->
            ${workExperience.length > 0 ? `
                <div style="margin-bottom: 30px;">
                    <h2 style="color: #2563eb; font-size: 1.5rem; margin-bottom: 15px; padding-bottom: 5px; border-bottom: 2px solid #e2e8f0;">
                        üíº –û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã
                    </h2>
                    ${workExperience.map(exp => `
                        <div style="margin-bottom: 20px; padding: 15px; background: #f8fafc; border-left: 4px solid #2563eb; border-radius: 4px;">
                            <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 5px;">
                                <h3 style="margin: 0; color: #1e293b; font-size: 1.1rem;">
                                    ${exp.position}
                                </h3>
                                <span style="color: #64748b; font-size: 0.9rem; white-space: nowrap;">
                                    ${formatDate(exp.start_date)} - ${exp.is_current ? '–Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è' : formatDate(exp.end_date)}
                                </span>
                            </div>
                            <div style="color: #2563eb; font-weight: 600; margin-bottom: 8px;">
                                ${exp.company}
                            </div>
                            ${exp.description ? `
                                <p style="margin: 8px 0 0 0; color: #475569; font-size: 0.95rem;">
                                    ${exp.description}
                                </p>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            ` : ''}

            <!-- –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ -->
            ${education.length > 0 ? `
                <div style="margin-bottom: 30px;">
                    <h2 style="color: #2563eb; font-size: 1.5rem; margin-bottom: 15px; padding-bottom: 5px; border-bottom: 2px solid #e2e8f0;">
                        üéì –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
                    </h2>
                    ${education.map(edu => `
                        <div style="margin-bottom: 20px; padding: 15px; background: #f8fafc; border-left: 4px solid #10b981; border-radius: 4px;">
                            <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 5px;">
                                <h3 style="margin: 0; color: #1e293b; font-size: 1.1rem;">
                                    ${edu.institution}
                                </h3>
                                <span style="color: #64748b; font-size: 0.9rem; white-space: nowrap;">
                                    ${formatDate(edu.start_date)} - ${edu.end_date ? formatDate(edu.end_date) : '–Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è'}
                                </span>
                            </div>
                            <div style="color: #10b981; font-weight: 600; margin-bottom: 5px;">
                                ${edu.degree} - ${edu.field_of_study}
                            </div>
                            ${edu.description ? `
                                <p style="margin: 8px 0 0 0; color: #475569; font-size: 0.95rem;">
                                    ${edu.description}
                                </p>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            ` : ''}

            <!-- –ù–∞–≤—ã–∫–∏ -->
            ${skills.length > 0 ? `
                <div style="margin-bottom: 30px;">
                    <h2 style="color: #2563eb; font-size: 1.5rem; margin-bottom: 15px; padding-bottom: 5px; border-bottom: 2px solid #e2e8f0;">
                        ‚ö° –ù–∞–≤—ã–∫–∏
                    </h2>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                        ${skills.map(skill => `
                            <div style="padding: 8px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 20px; font-size: 0.9rem; font-weight: 500;">
                                ${skill.name} 
                                <span style="opacity: 0.8; font-size: 0.85rem;">
                                    (${skill.level_display || skill.level})
                                </span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            ` : ''}

            <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
            ${achievements.length > 0 ? `
                <div style="margin-bottom: 30px;">
                    <h2 style="color: #2563eb; font-size: 1.5rem; margin-bottom: 15px; padding-bottom: 5px; border-bottom: 2px solid #e2e8f0;">
                        üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
                    </h2>
                    ${achievements.map(achievement => `
                        <div style="margin-bottom: 15px; padding: 12px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 4px;">
                            <div style="display: flex; justify-content: space-between; align-items: baseline;">
                                <h3 style="margin: 0; color: #92400e; font-size: 1rem;">
                                    ${achievement.title}
                                </h3>
                                ${achievement.date ? `
                                    <span style="color: #92400e; font-size: 0.85rem; opacity: 0.8;">
                                        ${formatDate(achievement.date)}
                                    </span>
                                ` : ''}
                            </div>
                            ${achievement.description ? `
                                <p style="margin: 5px 0 0 0; color: #78350f; font-size: 0.9rem;">
                                    ${achievement.description}
                                </p>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            ` : ''}

            <!-- –Ø–∑—ã–∫–∏ -->
            ${languages.length > 0 ? `
                <div style="margin-bottom: 30px;">
                    <h2 style="color: #2563eb; font-size: 1.5rem; margin-bottom: 15px; padding-bottom: 5px; border-bottom: 2px solid #e2e8f0;">
                        üåç –Ø–∑—ã–∫–∏
                    </h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        ${languages.map(lang => `
                            <div style="padding: 12px; background: #f0fdf4; border-left: 4px solid #22c55e; border-radius: 4px;">
                                <div style="font-weight: 600; color: #166534; margin-bottom: 4px;">
                                    ${lang.language}
                                </div>
                                <div style="color: #15803d; font-size: 0.9rem;">
                                    ${lang.proficiency_display || lang.proficiency_level}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            ` : ''}

            <!-- –§—É—Ç–µ—Ä -->
            <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #e2e8f0; text-align: center; color: #94a3b8; font-size: 0.85rem;">
                <p style="margin: 0;">–°–æ–∑–¥–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é Resume Builder</p>
            </div>
        </div>
    `;
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
function formatDate(dateString) {
    if (!dateString) return '-';
    const date = new Date(dateString);
    const options = { year: 'numeric', month: 'long' };
    return date.toLocaleDateString('ru-RU', options);
}

// –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π —à–∞–±–ª–æ–Ω–∞
function applyTemplateStyles(cssStyles) {
    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π style —ç–ª–µ–º–µ–Ω—Ç –µ—Å–ª–∏ –µ—Å—Ç—å
    const oldStyle = document.getElementById('template-styles');
    if (oldStyle) {
        oldStyle.remove();
    }
    
    // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π style —ç–ª–µ–º–µ–Ω—Ç
    const styleElement = document.createElement('style');
    styleElement.id = 'template-styles';
    styleElement.textContent = cssStyles;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ preview-content
    const previewContent = document.getElementById('previewContent');
    previewContent.appendChild(styleElement);
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã
function formatDate(dateString) {
    if (!dateString) return '-';
    const date = new Date(dateString);
    return date.toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' });
}
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            document.getElementById('personalInfoForm').addEventListener('submit', savePersonalInfo);
            document.getElementById('experienceForm').addEventListener('submit', saveExperience);
            document.getElementById('educationForm').addEventListener('submit', saveEducation);
            document.getElementById('skillForm').addEventListener('submit', saveSkill);
            document.getElementById('achievementForm').addEventListener('submit', saveAchievement);
            document.getElementById('languageForm').addEventListener('submit', saveLanguage);
        }
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —Ä–µ–∑—é–º–µ
        init();
        // ============= –§–£–ù–ö–¶–ò–ò –°–û–•–†–ê–ù–ï–ù–ò–Ø =============

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
async function savePersonalInfo(e) {
    e.preventDefault();
    
    const data = {
        full_name: document.getElementById('fullName').value,
        phone: document.getElementById('phone').value,
        email: document.getElementById('email').value,
        address: document.getElementById('address').value,
        linkedin: document.getElementById('linkedin').value,
        website: document.getElementById('website').value,
        summary: document.getElementById('summary').value
    };

    try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ –ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        let personalInfoExists = false;
        try {
            await API.personalInfo.get(resumeId);
            personalInfoExists = true;
        } catch (error) {
            // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 404, –∑–Ω–∞—á–∏—Ç –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –µ—â–µ –Ω–µ—Ç
            personalInfoExists = false;
        }

        if (personalInfoExists) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é
            await API.personalInfo.update(resumeId, data);
        } else {
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é
            await API.personalInfo.createOrUpdate(resumeId, data);
        }
        
        showAlert('alertPersonal', '–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!', 'success');
        await refreshPreview();
    } catch (error) {
        console.error('Error saving personal info:', error);
        showAlert('alertPersonal', error.detail || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
    }
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–π
function switchSection(section) {
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
    document.querySelectorAll('.section-content').forEach(s => {
        s.classList.remove('active');
    });
    
    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
    document.querySelectorAll('.section-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å–µ–∫—Ü–∏—é
    document.getElementById(section + 'Section').classList.add('active');
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É
    event.target.classList.add('active');
    
    currentSection = section;
}

// –ü–æ–∫–∞–∑–∞—Ç—å alert
function showAlert(elementId, message, type) {
    const alert = document.getElementById(elementId);
    alert.className = `alert alert-${type} show`;
    alert.textContent = message;
    
    setTimeout(() => {
        alert.classList.remove('show');
    }, 3000);
}

// ============= –û–ü–´–¢ –†–ê–ë–û–¢–´ =============

function openExperienceModal(id = null) {
    currentEditId = id;
    const modal = document.getElementById('experienceModal');
    const title = document.getElementById('experienceModalTitle');
    
    if (id) {
        title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã';
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        loadExperienceForEdit(id);
    } else {
        title.textContent = '–î–æ–±–∞–≤–∏—Ç—å –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã';
        document.getElementById('experienceForm').reset();
    }
    
    modal.classList.add('active');
}

function closeExperienceModal() {
    document.getElementById('experienceModal').classList.remove('active');
    document.getElementById('experienceForm').reset();
    currentEditId = null;
}

async function saveExperience(e) {
    e.preventDefault();
    
    const data = {
        company: document.getElementById('expCompany').value,
        position: document.getElementById('expPosition').value,
        start_date: document.getElementById('expStartDate').value,
        end_date: document.getElementById('expEndDate').value || null,
        is_current: document.getElementById('expIsCurrent').checked,
        description: document.getElementById('expDescription').value
    };

    try {
        if (currentEditId) {
            await API.workExperience.update(resumeId, currentEditId, data);
        } else {
            await API.workExperience.create(resumeId, data);
        }
        
        closeExperienceModal();
        await loadExperience();
        await refreshPreview();
        showAlert('alertExperience', '–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã —Å–æ—Ö—Ä–∞–Ω—ë–Ω!', 'success');
    } catch (error) {
        console.error('Error saving experience:', error);
        alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–ø—ã—Ç–∞ —Ä–∞–±–æ—Ç—ã');
    }
}

async function deleteExperience(id) {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã?')) return;
    
    try {
        await API.workExperience.delete(resumeId, id);
        await loadExperience();
        await refreshPreview();
        showAlert('alertExperience', '–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã —É–¥–∞–ª—ë–Ω', 'success');
    } catch (error) {
        console.error('Error deleting experience:', error);
    }
}

function toggleEndDate(prefix) {
    const checkbox = document.getElementById(prefix + 'IsCurrent');
    const endDate = document.getElementById(prefix + 'EndDate');
    endDate.disabled = checkbox.checked;
    if (checkbox.checked) {
        endDate.value = '';
    }
}

// ============= –û–ë–†–ê–ó–û–í–ê–ù–ò–ï =============

function openEducationModal(id = null) {
    currentEditId = id;
    const modal = document.getElementById('educationModal');
    const title = document.getElementById('educationModalTitle');
    
    if (id) {
        title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ';
    } else {
        title.textContent = '–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ';
        document.getElementById('educationForm').reset();
    }
    
    modal.classList.add('active');
}

function closeEducationModal() {
    document.getElementById('educationModal').classList.remove('active');
    document.getElementById('educationForm').reset();
    currentEditId = null;
}

async function saveEducation(e) {
    e.preventDefault();
    
    const data = {
        institution: document.getElementById('eduInstitution').value,
        degree: document.getElementById('eduDegree').value,
        field_of_study: document.getElementById('eduField').value,
        start_date: document.getElementById('eduStartDate').value,
        end_date: document.getElementById('eduEndDate').value || null,
        description: document.getElementById('eduDescription').value
    };

    try {
        if (currentEditId) {
            await API.education.update(resumeId, currentEditId, data);
        } else {
            await API.education.create(resumeId, data);
        }
        
        closeEducationModal();
        await loadEducation();
        await refreshPreview();
        showAlert('alertEducation', '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!', 'success');
    } catch (error) {
        console.error('Error saving education:', error);
        alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è');
    }
}

// ============= –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –û–ü–´–¢–ê –†–ê–ë–û–¢–´ =============

async function editExperience(id) {
    currentEditId = id;
    
    try {
        // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ–ø—ã—Ç–∞ —Ä–∞–±–æ—Ç—ã
        const experiences = await API.workExperience.list(resumeId);
        const experience = experiences.find(exp => exp.id === id);
        
        if (!experience) {
            alert('–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
        }
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏
        document.getElementById('expCompany').value = experience.company;
        document.getElementById('expPosition').value = experience.position;
        document.getElementById('expStartDate').value = experience.start_date;
        document.getElementById('expEndDate').value = experience.end_date || '';
        document.getElementById('expIsCurrent').checked = experience.is_current;
        document.getElementById('expDescription').value = experience.description || '';
        
        // –ë–ª–æ–∫–∏—Ä—É–µ–º/—Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è
        document.getElementById('expEndDate').disabled = experience.is_current;
        
        // –ú–µ–Ω—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.getElementById('experienceModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã';
        
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        document.getElementById('experienceModal').classList.add('active');
    } catch (error) {
        console.error('Error loading experience for edit:', error);
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
    }
}

// ============= –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –û–ë–†–ê–ó–û–í–ê–ù–ò–Ø =============

async function editEducation(id) {
    currentEditId = id;
    
    try {
        const educations = await API.education.list(resumeId);
        const education = educations.find(edu => edu.id === id);
        
        if (!education) {
            alert('–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            return;
        }
        
        document.getElementById('eduInstitution').value = education.institution;
        document.getElementById('eduDegree').value = education.degree;
        document.getElementById('eduField').value = education.field_of_study;
        document.getElementById('eduStartDate').value = education.start_date;
        document.getElementById('eduEndDate').value = education.end_date || '';
        document.getElementById('eduDescription').value = education.description || '';
        
        document.getElementById('educationModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ';
        document.getElementById('educationModal').classList.add('active');
    } catch (error) {
        console.error('Error loading education for edit:', error);
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
    }
}

// ============= –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –ù–ê–í–´–ö–ê =============

async function editSkill(id) {
    currentEditId = id;
    
    try {
        const skills = await API.skills.list(resumeId);
        const skill = skills.find(s => s.id === id);
        
        if (!skill) {
            alert('–ù–∞–≤—ã–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
        }
        
        document.getElementById('skillName').value = skill.name;
        document.getElementById('skillLevel').value = skill.level;
        document.getElementById('skillCategory').value = skill.category;
        
        document.getElementById('skillModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≤—ã–∫';
        document.getElementById('skillModal').classList.add('active');
    } catch (error) {
        console.error('Error loading skill for edit:', error);
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
    }
}

// ============= –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –î–û–°–¢–ò–ñ–ï–ù–ò–Ø =============

async function editAchievement(id) {
    currentEditId = id;
    
    try {
        const achievements = await API.achievements.list(resumeId);
        const achievement = achievements.find(a => a.id === id);
        
        if (!achievement) {
            alert('–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            return;
        }
        
        document.getElementById('achievementTitle').value = achievement.title;
        document.getElementById('achievementDate').value = achievement.date || '';
        document.getElementById('achievementDescription').value = achievement.description || '';
        
        document.getElementById('achievementModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ';
        document.getElementById('achievementModal').classList.add('active');
    } catch (error) {
        console.error('Error loading achievement for edit:', error);
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
    }
}

// ============= –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –Ø–ó–´–ö–ê =============

async function editLanguage(id) {
    currentEditId = id;
    
    try {
        const languages = await API.languages.list(resumeId);
        const language = languages.find(l => l.id === id);
        
        if (!language) {
            alert('–Ø–∑—ã–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
        }
        
        document.getElementById('languageName').value = language.language;
        document.getElementById('languageLevel').value = language.proficiency_level;
        
        document.getElementById('languageModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —è–∑—ã–∫';
        document.getElementById('languageModal').classList.add('active');
    } catch (error) {
        console.error('Error loading language for edit:', error);
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
    }
}

function createEducationCard(item) {
    const card = document.createElement('div');
    card.className = 'item-card';
    
    card.innerHTML = `
        <h4>${item.institution}</h4>
        <p><strong>${item.degree}</strong> - ${item.field_of_study}</p>
        <p>${formatDate(item.start_date)} - ${item.end_date ? formatDate(item.end_date) : '–Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è'}</p>
        ${item.description ? `<p>${item.description.substring(0, 100)}${item.description.length > 100 ? '...' : ''}</p>` : ''}
        <div class="item-actions">
            <button class="btn btn-small btn-secondary" onclick="openEducationModal(${item.id})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn btn-small btn-secondary" onclick="deleteEducation(${item.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
        </div>
    `;
    
    return card;
}

async function deleteEducation(id) {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ?')) return;
    
    try {
        await API.education.delete(resumeId, id);
        await loadEducation();
        await refreshPreview();
        showAlert('alertEducation', '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'success');
    } catch (error) {
        console.error('Error deleting education:', error);
    }
}

// ============= –ù–ê–í–´–ö–ò =============

function openSkillModal(id = null) {
    currentEditId = id;
    const modal = document.getElementById('skillModal');
    const title = document.getElementById('skillModalTitle');
    
    if (id) {
        title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≤—ã–∫';
    } else {
        title.textContent = '–î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≤—ã–∫';
        document.getElementById('skillForm').reset();
    }
    
    modal.classList.add('active');
}

function closeSkillModal() {
    document.getElementById('skillModal').classList.remove('active');
    document.getElementById('skillForm').reset();
    currentEditId = null;
}

async function saveSkill(e) {
    e.preventDefault();
    
    const data = {
        name: document.getElementById('skillName').value,
        level: document.getElementById('skillLevel').value,
        category: document.getElementById('skillCategory').value
    };

    try {
        if (currentEditId) {
            await API.skills.update(resumeId, currentEditId, data);
        } else {
            await API.skills.create(resumeId, data);
        }
        
        closeSkillModal();
        await loadSkills();
        await refreshPreview();
        showAlert('alertSkills', '–ù–∞–≤—ã–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!', 'success');
    } catch (error) {
        console.error('Error saving skill:', error);
        alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞–≤—ã–∫–∞');
    }
}

function createSkillCard(item) {
    const card = document.createElement('div');
    card.className = 'item-card';
    
    card.innerHTML = `
        <h4>${item.name}</h4>
        <p><strong>–£—Ä–æ–≤–µ–Ω—å:</strong> ${item.level_display || item.level}</p>
        <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${item.category_display || item.category}</p>
        <div class="item-actions">
            <button class="btn btn-small btn-secondary" onclick="openSkillModal(${item.id})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn btn-small btn-secondary" onclick="deleteSkill(${item.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
        </div>
    `;
    
    return card;
}

async function deleteSkill(id) {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –Ω–∞–≤—ã–∫?')) return;
    
    try {
        await API.skills.delete(resumeId, id);
        await loadSkills();
        await refreshPreview();
        showAlert('alertSkills', '–ù–∞–≤—ã–∫ —É–¥–∞–ª—ë–Ω', 'success');
    } catch (error) {
        console.error('Error deleting skill:', error);
    }
}

// ============= –î–û–°–¢–ò–ñ–ï–ù–ò–Ø =============

function openAchievementModal(id = null) {
    currentEditId = id;
    const modal = document.getElementById('achievementModal');
    const title = document.getElementById('achievementModalTitle');
    
    if (id) {
        title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ';
    } else {
        title.textContent = '–î–æ–±–∞–≤–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ';
        document.getElementById('achievementForm').reset();
    }
    
    modal.classList.add('active');
}

function closeAchievementModal() {
    document.getElementById('achievementModal').classList.remove('active');
    document.getElementById('achievementForm').reset();
    currentEditId = null;
}

async function saveAchievement(e) {
    e.preventDefault();
    
    const data = {
        title: document.getElementById('achievementTitle').value,
        date: document.getElementById('achievementDate').value || null,
        description: document.getElementById('achievementDescription').value
    };

    try {
        if (currentEditId) {
            await API.achievements.update(resumeId, currentEditId, data);
        } else {
            await API.achievements.create(resumeId, data);
        }
        
        closeAchievementModal();
        await loadAchievements();
        await refreshPreview();
        showAlert('alertAchievements', '–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!', 'success');
    } catch (error) {
        console.error('Error saving achievement:', error);
        alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è');
    }
}

async function deleteAchievement(id) {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ?')) return;
    
    try {
        await API.achievements.delete(resumeId, id);
        await loadAchievements();
        await refreshPreview();
        showAlert('alertAchievements', '–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'success');
    } catch (error) {
        console.error('Error deleting achievement:', error);
    }
}

// ============= –Ø–ó–´–ö–ò =============

function openLanguageModal(id = null) {
    currentEditId = id;
    const modal = document.getElementById('languageModal');
    const title = document.getElementById('languageModalTitle');
    
    if (id) {
        title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —è–∑—ã–∫';
    } else {
        title.textContent = '–î–æ–±–∞–≤–∏—Ç—å —è–∑—ã–∫';
        document.getElementById('languageForm').reset();
    }
    
    modal.classList.add('active');
}

function closeLanguageModal() {
    document.getElementById('languageModal').classList.remove('active');
    document.getElementById('languageForm').reset();
    currentEditId = null;
}

async function saveLanguage(e) {
    e.preventDefault();
    
    const data = {
        language: document.getElementById('languageName').value,
        proficiency_level: document.getElementById('languageLevel').value
    };

    try {
        if (currentEditId) {
            await API.languages.update(resumeId, currentEditId, data);
        } else {
            await API.languages.create(resumeId, data);
        }
        
        closeLanguageModal();
        await loadLanguages();
        await refreshPreview();
        showAlert('alertLanguages', '–Ø–∑—ã–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!', 'success');
    } catch (error) {
        console.error('Error saving language:', error);
        alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —è–∑—ã–∫–∞');
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ
// –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ
async function uploadPhoto() {
    const fileInput = document.getElementById('photoInput');
    const file = fileInput.files[0];
    
    if (!file) return;
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
    if (file.size > 5 * 1024 * 1024) {
        showAlert('alertPhoto', '–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5MB', 'error');
        fileInput.value = '';
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞
    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
    if (!allowedTypes.includes(file.type)) {
        showAlert('alertPhoto', '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, WEBP', 'error');
        fileInput.value = '';
        return;
    }
    
    try {
        const response = await API.resumes.uploadPhoto(resumeId, file);
        showAlert('alertPhoto', '–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!', 'success');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é
        document.getElementById('photoImage').src = response.photo_url;
        document.getElementById('currentPhoto').style.display = 'block';
        
        // ‚Üê –î–û–ë–ê–í–¨ –≠–¢–ò –°–¢–†–û–ö–ò
        // –û–±–Ω–æ–≤–ª—è–µ–º resumeData —á—Ç–æ–±—ã —Ñ–æ—Ç–æ –ø–æ—è–≤–∏–ª–æ—Å—å –≤ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–µ
        resumeData = await API.resumes.get(resumeId);
        
        // –û—á–∏—â–∞–µ–º input
        fileInput.value = '';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—é–º–µ
        await refreshPreview();
        
    } catch (error) {
        console.error('Error uploading photo:', error);
        showAlert('alertPhoto', error.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏', 'error');
        fileInput.value = '';
    }
}

// –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ
// –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ
async function removePhoto() {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é?')) return;
    
    try {
        await API.resumes.deletePhoto(resumeId);
        showAlert('alertPhoto', '–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —É–¥–∞–ª–µ–Ω–∞', 'success');
        
        // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
        document.getElementById('currentPhoto').style.display = 'none';
        document.getElementById('photoImage').src = '';
        
        // ‚Üê –î–û–ë–ê–í–¨ –≠–¢–£ –°–¢–†–û–ö–£
        // –û–±–Ω–æ–≤–ª—è–µ–º resumeData
        resumeData = await API.resumes.get(resumeId);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—é–º–µ
        await refreshPreview();
        
    } catch (error) {
        console.error('Error deleting photo:', error);
        showAlert('alertPhoto', '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏', 'error');
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–æ—Ç–æ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
async function loadCurrentPhoto() {
    try {
        const data = await API.resumes.get(resumeId);
        if (data.photo) {
            document.getElementById('photoImage').src = data.photo;
            document.getElementById('currentPhoto').style.display = 'block';
        }
    } catch (error) {
        console.log('No photo loaded');
    }
}

async function deleteLanguage(id) {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —è–∑—ã–∫?')) return;
    
    try {
        await API.languages.delete(resumeId, id);
        await loadLanguages();
        await refreshPreview();
        showAlert('alertLanguages', '–Ø–∑—ã–∫ —É–¥–∞–ª—ë–Ω', 'success');
    } catch (error) {
        console.error('Error deleting language:', error);
    }
}

// ============= –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =============

function saveResume() {
    showAlert('alertPersonal', '–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏', 'success');
}

function exportPDF() {
    API.resumes.exportPDF(resumeId);
}

    async function changeTemplate() {
    const templateId = document.getElementById('templateSelect').value;
    if (!templateId) return;
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—ã–π —à–∞–±–ª–æ–Ω
    await loadTemplate(templateId);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∑—é–º–µ –≤ –±–∞–∑–µ
    try {
        await API.resumes.update(resumeId, { template: parseInt(templateId) });
        await refreshPreview();
        showAlert('alertPersonal', '–®–∞–±–ª–æ–Ω –∏–∑–º–µ–Ω—ë–Ω!', 'success');
    } catch (error) {
        console.error('Error changing template:', error);
        showAlert('alertPersonal', '–û—à–∏–±–∫–∞ —Å–º–µ–Ω—ã —à–∞–±–ª–æ–Ω–∞', 'error');
    }
}

function zoomIn() {
    zoomScale = Math.min(zoomScale + 0.1, 1.5);
    updateZoom();
}

function zoomOut() {
    zoomScale = Math.max(zoomScale - 0.1, 0.5);
    updateZoom();
}

function updateZoom() {
    const wrapper = document.getElementById('previewWrapper');
    wrapper.style.transform = `scale(${zoomScale})`;
    document.getElementById('zoomLevel').textContent = `${Math.round(zoomScale * 100)}%`;
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
        event.target.classList.remove('active');
    }
}


    </script>
</body>
</html>
    <style>
        /* File Input */
    input[type="file"] {
    padding: 0.75rem;
    border: 2px dashed #e2e8f0;
    border-radius: 8px;
    cursor: pointer;
    background: #f8fafc;
    transition: all 0.3s;
    }

    input[type="file"]:hover {
    border-color: #2563eb;
    background: #eff6ff;
    }

        /* Reset and Base Styles */
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f1f5f9;
            color: #1e293b;
        }
        header {
            background: #2563eb;
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            text-decoration: none;
        }
        .nav-actions button {
            margin-left: 1rem;
        }
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        .btn-primary {
            background: #2563eb;
            color: white;
        }
        .btn-primary:hover {
            background: #1e40af;
        }
        .btn-secondary {
            background: #e2e8f0;
            color: #1e293b;
        }
        .btn-secondary:hover {
            background: #cbd5e1;
        }
        .btn-success {
            background: #16a34a;
            color: white;
        }
        .btn-success:hover {
            background: #15803d;
        }
        /* Editor Layout */
        .editor-container {
            display: grid;
            grid-template-columns: 400px 1fr;
            height: calc(100vh - 64px);
        }
        .sidebar {
            background: white;
            border-right: 2px solid #e2e8f0;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 2px solid #e2e8f0;
        }
        .sidebar-header h2 {
            margin: 0 0 0.5rem 0;
            font-size: 1.25rem;
        }
        .template-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .template-selector label {
            font-size: 0.9rem;
            color: #475569;
        }
        .template-selector select {
            padding: 0.4rem;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        .sections-nav {
            display: flex;
            flex-direction: column;
            border-bottom: 2px solid #e2e8f0;
        }
        .section-btn {
            background: none;
            border: none;
            text-align: left;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            color: #475569;
            cursor: pointer;
            border-left: 4px solid transparent;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }
        .section-btn:hover {
            background: #f1f5f9;
        }
        .section-btn.active {
            border-left-color: #2563eb;
            background: #e0e7ff;
            color: #1e293b;
            font-weight: 600;
        }
        .section-btn span {
            background: #2563eb;
            color: white;
            border-radius: 12px;
            padding: 0.1rem 0.5rem;
            font-size: 0.75rem;
        }
        .section-content {
            flex: 1;
            padding: 1.5rem;
            display: none;
            flex-direction: column;
            overflow-y: auto;
        }
        .section-content.active {
            display: flex;
        }
        .section-content h3 {
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            color: #1e293b;
        }